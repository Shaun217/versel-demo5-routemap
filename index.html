<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 智能路线规划 (带地图)</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="header">
                <h2>🗺️ AI 路线智绘</h2>
                <p>自动规划最优顺序并绘制轨迹</p>
            </div>

            <div class="settings">
                <input type="password" id="apiKey" placeholder="在此粘贴 DeepSeek/OpenAI Key" autocomplete="off">
            </div>

            <div class="form-container">
                <div class="input-group">
                    <label>🟢 起点</label>
                    <input type="text" id="startPoint" placeholder="例如：北京大兴机场" value="北京南站">
                </div>

                <div class="input-group">
                    <label>🔴 终点</label>
                    <input type="text" id="endPoint" placeholder="例如：北京环球影城" value="三里屯太古里">
                </div>

                <div class="input-group">
                    <label>📍 途径点 (每行一个)</label>
                    <textarea id="waypoints" rows="5" placeholder="故宫博物院
天坛公园
颐和园
南锣鼓巷"></textarea>
                </div>

                <button id="planBtn" onclick="startPlanning()">🚀 智能规划路线</button>
            </div>

            <div id="aiAnalysis" class="ai-output hidden">
                <h3>🤖 AI 规划分析</h3>
                <div id="markdownOutput" class="markdown-body"></div>
            </div>
        </aside>

        <main class="map-container">
            <div id="map"></div>
            <div id="loadingOverlay" class="hidden">
                <div class="spinner"></div>
                <p id="loadingText">正在初始化...</p>
            </div>
        </main>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="script.js"></script>
</body>
</html>